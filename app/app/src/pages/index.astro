---
import { getCollection, getEntry } from 'astro:content'
import Layout from '~/layouts/Layout.astro'

import { i18nFactory } from '~/i18n'
const _ = i18nFactory(Astro.currentLocale as any)

const documents = await getCollection('documents')

function getTitleFromBody(body: string): string | undefined
{
	// Get text from heading 1 in markdown body
	const match = body.match(/^#\s+(.*)$/m)
	return match ? match[1] : undefined
}
---

<Layout>

	<div class="main">

		<p>
			<span class="icon icon-[mdi--hand-wave] icon-align icon-fw"></span>
			{_({
				en: 'Welcome!',
				fr: 'Bienvenue !',
			})}
		</p>

		{documents.length > 0
			? (
				<p>
					{_({
						en: 'See association documents:',
						fr: 'Voir les documents de l\'association :',
					})}
				</p>

				<ul>
					{documents.map((document) => (
						<li>
							<a href={`/documents/${document.slug}`}>{getTitleFromBody(document.body) || document.slug}</a>
						</li>
					))}
				</ul>
			)
			: (
				<p>
					{_({
						en: 'No documents available.',
						fr: 'Aucun document disponible.',
					})}
				</p>
			)
		}

	</div>

</Layout>

<style lang="scss">
.main {
	@apply m-2 border-l-2 border-gray-300 px-6 py-4;
}

*:last-child {
	@apply mb-0;
}

p {
	@apply mb-2;
}

ul {
	@apply list-disc list-inside;

	li {
		@apply mb-2 pl-2;
	}

	a {
		@apply text-blue-500 hover:text-blue-700 hover:underline;
	}
}
</style>
